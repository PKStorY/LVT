<script>
    /**
     * TEMPLATE: STORAGE TICKET (80mm)
     * โครงสร้าง HTML สำหรับตั๋วฝากของ
     * Update: Use Square Brackets [ ] for Payment Method
     */
    function generateStorageTicketHtml(data) {
        const {
            ownerName, stallName, amount, note, method, officer,
            timestampStr, startDateStr, endDateStr
        } = data;

        const val = parseFloat(amount || 0);
        const preVat = val / 1.07;
        const vat = val - preVat;
        const methodDisplay = (method === 'Cash') ? 'เงินสด' : (method === 'Transfer' ? 'โอน' : method);

        const IMG_LOGO_URL = "https://img2.pic.in.th/pic/Profile-Alpha_0.png";
        const IMG_QR_URL = "https://img5.pic.in.th/file/secure-sv1/S_gainfriends_2dbarcodes_BW73c64bbdc0272b36.png";

        // Helper: Format number with commas and 2 decimals
        const fmt = (n) => parseFloat(n || 0).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        return `
            <div style="font-family: 'Sarabun', sans-serif; color: black; line-height: 1.3; width: 100%; max-width: 300px; margin: 0 auto; background: white; padding: 5px; font-size: 14px;">
                
                <!-- 1. Header -->
                <div style="text-align: center;">
                    <img src="${IMG_LOGO_URL}" style="width: 90px; height: auto; margin: 0 auto; display: block;" loading="eager">
                    <div style="font-size: 18px; font-weight: bold; margin-top: 5px;">ตลาดนัดลาดสวายวินเทจ</div>
                    <div style="font-size: 14px;">เลขที่ 52/34 หมู่ 5</div>
                    <div style="font-size: 14px;">ต.ลาดสวาย อ.ลำลูกกา จ.ปทุมธานี 12150</div>
                    <div style="font-size: 14px;">โทร: 0-92-869-7774 , 0-92-869-7775</div>
                    <div style="border-bottom: 1px dashed #000; margin: 5px 0;"></div>
                    <div style="font-size: 16px; font-weight: bold;">ตั๋ว/ใบเสร็จ (ฝากของ)</div>
                </div>

                <!-- 2. Bill & Customer Info -->
                <div style="margin-top: 5px;">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">วันที่ทำรายการ : </span>
                        <span style="text-align: right;">${timestampStr}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">รหัสพนักงาน : </span>
                        <span style="text-align: right;">${officer}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">วันที่เริ่ม : </span>
                        <span style="text-align: right; font-weight: bold; font-size: 16px;">${startDateStr}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">วันที่สิ้นสุด : </span>
                        <span style="text-align: right; font-weight: bold; font-size: 16px;">${endDateStr}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">ชื่อผู้ฝาก : </span>
                        <span style="text-align: right; font-weight: bold;">${ownerName}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">วางของไว้ล็อค : </span>
                        <span style="text-align: right; font-weight: bold; font-size: 16px;">${stallName}</span>
                    </div>
                    <div style="height: 0.2em;"></div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="text-align: left;">ค่าฝากของ : </span>
                        <span style="text-align: right; font-weight: bold; font-size: 16px;">${fmt(val)}</span>
                    </div>
                </div>
                <div style="border-bottom: 1px dashed #000; margin: 5px 0;"></div>

                <!-- 3. Details (Note) -->
                <div style="margin-top: 2px; display: flex;">
                    <div style="text-align: left; width: 40%; flex-shrink: 0;">รายการที่ฝาก : </div>
                    <div style="text-align: left; width: 60%;">${note || "-"}</div>
                </div>
                <div style="border-bottom: 1px dashed #000; margin: 5px 0;"></div>

                <!-- 4. Summary & Tax -->
                <div style="margin-top: 2px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                        <div style="text-align: right; width: 60%;">ราคาไม่รวมภาษีมูลค่าเพิ่ม : </div>
                        <div style="text-align: right; width: 40%;">${fmt(preVat)}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                        <div style="text-align: right; width: 60%;">ภาษีมูลค่าเพิ่ม 7% : </div>
                        <div style="text-align: right; width: 40%;">${fmt(vat)}</div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                        <div style="text-align: right; width: 60%; font-weight: bold;">รวมเป็นเงินทั้งสิ้น : </div>
                        <div style="text-align: right; width: 40%; font-weight: bold; font-size: 16px;">${fmt(val)}</div>
                    </div>
                    
                    <div style="height: 0.3em;"></div>
                    
                    <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                         <!-- FIX: Use Square Brackets -->
                         <div style="text-align: right; width: 60%; font-weight: bold;">การชำระเงิน [${methodDisplay}] : </div>
                         <div style="text-align: right; width: 40%; font-weight: bold; font-size: 16px;">${fmt(val)}</div>
                    </div>
                </div>
                <div style="border-bottom: 1px dashed #000; margin: 5px 0;"></div>

                <!-- 5. Conditions (Size 10px) -->
                <div style="text-align: left; font-size: 10px; margin-top: 5px;">
                    <div style="font-weight: bold; margin-bottom: 2px;">รายละเอียดและเงื่อนไขการฝากของมีดังต่อไปนี้</div>
                    <div style="margin-bottom: 2px;">1. การฝากของในที่นี้หมายถึง การเช่าพื้นที่วางของเท่านั้น</div>
                    <div style="margin-bottom: 2px;">2. ทางตลาดฯ ไม่รับผิดชอบความเสียหาย สูญหายที่เกิดขึ้นทุกกรณี</div>
                    <div style="margin-bottom: 2px;">3. ในวันที่มีนัด หากลูกค้าไม่มาทำการค้า ทางตลาดมีสิทธิในการย้ายของไปไว้ที่อื่นทุกกรณี และหากของที่ฝากมีขนาดใหญ่ ไม่สามารถเคลื่อนย้ายได้สะดวก ทางตลาดฯ คิดค่าล็อคในนัดนั้น</div>
                    <div style="margin-bottom: 2px;">4. เมื่อสิ้นสุดระยะเวลาฝากของ และไม่ได้ทำการต่อระยะเวลาฝากของ หากลูกค้าไม่มารับหรือมารับในภายหลัง ทางตลาดฯ คิดค่าฝากของย้อนหลัง</div>
                    <div>5. การชำระค่าฝากของ ถือว่าลูกค้าได้รับทราบรายละเอียดและเงื่อนไขการฝากของดังกล่าวแล้ว และจะปฏิบัติตามอย่างเคร่งครัด</div>
                </div>
                
                <!-- 6. Footer -->
                <div style="margin-top: 15px; text-align: center;">
                    <div style="font-size: 10px; margin-bottom: 5px;">สอบถามข้อมูลการฝากของได้ที่</div>
                    <img src="${IMG_QR_URL}" style="width: 100px; height: auto; margin: 0 auto; display: block;" loading="eager">
                    <div style="font-size: 10px; margin-top: 5px;">@ladsawaivintage</div>
                    <div style="height: 0.1em;"></div>
                    <div style="font-size: 6px;">Power by PJMJK</div>
                </div>
            </div>
        `;
    }
</script>