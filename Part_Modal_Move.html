<!-- Move Booking Modal -->
<div id="moveBookingModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-60 flex items-center justify-center z-[70]">
    <div class="bg-white w-96 rounded-xl shadow-2xl p-0 overflow-hidden animate-bounce-in flex flex-col max-h-[85vh]">
        <div class="bg-gradient-to-r from-purple-600 to-indigo-600 px-4 py-3 flex justify-between items-center shrink-0">
            <h3 class="font-bold text-lg text-white flex items-center gap-2">
                <i class="fa-solid fa-share-from-square"></i> ย้ายล็อค
            </h3>
            <button onclick="closeMoveModal()" class="text-white hover:text-red-200 transition">
                <i class="fa-solid fa-times text-lg"></i>
            </button>
        </div>

        <div class="p-5 overflow-y-auto">
            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 mb-4 text-sm">
                <div class="flex justify-between mb-1">
                    <span class="text-gray-500">ล็อคเดิม:</span>
                    <span class="font-bold text-gray-700" id="mv_oldStall">-</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-500">วันที่เดิม:</span>
                    <span class="font-bold text-gray-700" id="mv_oldDate">-</span>
                </div>
            </div>

            <div class="space-y-3">
                <div>
                    <label class="block text-xs font-bold text-gray-600 mb-1">ย้ายไปวันที่</label>
                    <input type="date" id="mv_newDate" onchange="fetchAvailableStallsForMove()" class="w-full border p-2 rounded text-sm focus:ring-2 focus:ring-purple-400 outline-none">
                </div>
                
                <div class="relative">
                    <label class="block text-xs font-bold text-gray-600 mb-1">ล็อคใหม่ (ค้นหาชื่อล็อค)</label>
                    <div class="relative">
                        <input type="text" id="mv_stallSearch" onkeyup="filterMoveStalls()" onfocus="showMoveStallList()" placeholder="พิมพ์ชื่อล็อคที่ต้องการ..." class="w-full border p-2 rounded text-sm focus:ring-2 focus:ring-purple-400 outline-none uppercase">
                        <input type="hidden" id="mv_newStall">
                        <div class="absolute right-2 top-2 pointer-events-none">
                            <i id="mv_stallLoading" class="fa-solid fa-circle-notch fa-spin text-purple-500 hidden"></i>
                            <i id="mv_stallArrow" class="fa-solid fa-chevron-down text-gray-400"></i>
                        </div>
                    </div>
                    <div id="mv_stallDropdownList" class="hidden absolute w-full bg-white border border-gray-200 rounded-b-lg shadow-xl max-h-48 overflow-y-auto z-10 mt-1">
                        <div class="p-2 text-xs text-gray-400 text-center">กรุณาเลือกวันที่ก่อน</div>
                    </div>
                </div>

                <button onclick="checkMovePrice()" class="w-full bg-blue-50 text-blue-600 px-3 py-2 rounded hover:bg-blue-100 text-xs font-bold transition border border-blue-100 mt-2"><i class="fa-solid fa-calculator mr-1"></i> คำนวณส่วนต่าง</button>
            </div>

            <!-- Result & Payment Area -->
            <div id="mv_resultArea" class="mt-4 hidden">
                <div class="p-3 rounded-lg border text-sm flex flex-col gap-1" id="mv_resultBox">
                    <div class="flex justify-between">
                        <span>มูลค่าที่มี (Credit):</span>
                        <span id="mv_res_oldPrice">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ราคาใหม่:</span>
                        <span id="mv_res_newPrice">0</span>
                    </div>
                    <div class="border-t my-1"></div>
                    <div class="flex justify-between font-bold text-base">
                        <span>ส่วนต่าง:</span>
                        <span id="mv_res_diff">0</span>
                    </div>
                    <p class="text-xs mt-1 text-center" id="mv_res_msg"></p>
                </div>

                <!-- Payment Options (Show only if diff > 0) -->
                <div id="mv_paymentOptions" class="mt-3 hidden animate-bounce-in">
                    <label class="block text-xs font-bold text-gray-700 mb-1">จัดการส่วนต่าง</label>
                    
                    <!-- FIX: Added Pay Now/Later Toggle -->
                    <div class="flex gap-2 mb-2">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="mv_payDecision" value="payNow" checked class="peer hidden" onchange="toggleMovePaymentMethod(this.value)">
                            <div class="peer-checked:bg-green-600 peer-checked:text-white bg-white border border-gray-300 text-gray-600 px-2 py-1.5 rounded text-center text-xs font-bold transition">ชำระทันที</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="mv_payDecision" value="payLater" class="peer hidden" onchange="toggleMovePaymentMethod(this.value)">
                            <div class="peer-checked:bg-orange-500 peer-checked:text-white bg-white border border-gray-300 text-gray-600 px-2 py-1.5 rounded text-center text-xs font-bold transition">ค้างชำระไว้ก่อน</div>
                        </label>
                    </div>

                    <!-- Payment Method (Visible only if Pay Now) -->
                    <div id="mv_payMethodsContainer" class="flex gap-2">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="mv_payMethod" value="Cash" checked class="peer hidden">
                            <div class="peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 bg-white border border-gray-300 text-gray-600 px-3 py-1.5 rounded text-center text-xs font-bold transition">
                                <i class="fa-solid fa-money-bill mr-1"></i> เงินสด
                            </div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="mv_payMethod" value="Transfer" class="peer hidden">
                            <div class="peer-checked:bg-blue-600 peer-checked:text-white peer-checked:border-blue-600 bg-white border border-gray-300 text-gray-600 px-3 py-1.5 rounded text-center text-xs font-bold transition">
                                <i class="fa-solid fa-mobile-screen mr-1"></i> โอน
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <div class="mt-6 flex gap-2">
                <button onclick="closeMoveModal()" class="flex-1 py-2 bg-gray-100 text-gray-600 rounded-lg font-bold text-sm hover:bg-gray-200 transition">ยกเลิก</button>
                <button id="btnConfirmMove" onclick="submitMoveBooking()" class="flex-1 py-2 bg-purple-600 text-white rounded-lg font-bold text-sm hover:bg-purple-700 shadow transition opacity-50 cursor-not-allowed" disabled>ยืนยันการย้าย</button>
            </div>
        </div>
    </div>
</div>